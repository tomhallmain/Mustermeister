<div class="container mx-auto px-2 py-4" data-kanban-i18n="<%= { previous_page: t('views.tasks.kanban.previous_page'), reset_to_first_page: t('views.tasks.kanban.reset_to_first_page'), load_more: t('views.tasks.kanban.load_more'), show_completed: t('views.tasks.index.show_completed'), hide_completed: t('views.tasks.index.hide_completed') }.to_json %>">
  <div class="flex justify-between items-center mb-4">
    <h1 class="kanban-page-title text-sm font-bold text-gray-900"><%= t('views.tasks.kanban.title') %></h1>
    
    <div class="flex items-center space-x-4">
      <select id="project-filter" class="rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
        <option value=""><%= t('views.tasks.kanban.all_projects') %></option>
        <% @projects.each do |project| %>
          <option value="<%= project.id %>" <%= 'selected' if @current_project&.id == project.id %>><%= project.title %></option>
        <% end %>
      </select>

      <select id="priority-filter" class="rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
        <option value=""><%= t('views.tasks.kanban.all_priorities') %></option>
        <option value="high" <%= 'selected' if @priority_filter == 'high' %>><%= t('priorities.high') %></option>
        <option value="medium" <%= 'selected' if @priority_filter == 'medium' %>><%= t('priorities.medium') %></option>
        <option value="low" <%= 'selected' if @priority_filter == 'low' %>><%= t('priorities.low') %></option>
        <option value="leisure" <%= 'selected' if @priority_filter == 'leisure' %>><%= t('priorities.leisure') %></option>
      </select>

      <select id="sort-by" class="rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
        <option value="updated_at" <%= 'selected' if @sort_by == 'updated_at' %>><%= t('views.tasks.kanban.sort.last_updated') %></option>
        <option value="created_at" <%= 'selected' if @sort_by == 'created_at' %>><%= t('views.tasks.kanban.sort.created_at') %></option>
        <option value="priority" <%= 'selected' if @sort_by == 'priority' %>><%= t('views.tasks.kanban.sort.priority') %></option>
      </select>

      <select id="updated-within-days" class="rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
        <option value=""><%= t('views.tasks.kanban.all_time') %></option>
        <option value="1"><%= t('views.tasks.kanban.updated_within.last_1_day') %></option>
        <option value="3"><%= t('views.tasks.kanban.updated_within.last_3_days') %></option>
        <option value="7"><%= t('views.tasks.kanban.updated_within.last_7_days') %></option>
        <option value="14"><%= t('views.tasks.kanban.updated_within.last_14_days') %></option>
        <option value="30"><%= t('views.tasks.kanban.updated_within.last_30_days') %></option>
        <option value="60"><%= t('views.tasks.kanban.updated_within.last_60_days') %></option>
        <option value="90"><%= t('views.tasks.kanban.updated_within.last_90_days') %></option>
        <option value="-7"><%= t('views.tasks.kanban.updated_within.not_7_days') %></option>
        <option value="-14"><%= t('views.tasks.kanban.updated_within.not_14_days') %></option>
        <option value="-30"><%= t('views.tasks.kanban.updated_within.not_30_days') %></option>
      </select>

      <div class="relative">
        <input type="text" id="search-input" 
               class="rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50 pl-8"
               placeholder="<%= t('views.tasks.kanban.search_placeholder') %>">
        <div class="absolute inset-y-0 left-0 pl-2 flex items-center pointer-events-none">
          <svg class="h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
          </svg>
        </div>
      </div>
    </div>

    <button type="button" id="show-all-completed-btn" 
            class="flex items-center space-x-2 px-4 py-2 rounded-md bg-gray-100 text-gray-700 hover:bg-opacity-80 text-xs">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
      </svg>
      <span id="show-all-completed-text"><%= t('views.tasks.index.show_completed') %></span>
    </button>
    <input type="checkbox" id="show-all-completed" class="hidden" />
  </div>

  <div id="kanban-board" class="flex space-x-2 overflow-x-auto pb-4">
    <% { not_started: 'Not Started', investigations: 'To Investigate', in_progress: 'In Progress', ready_to_test: 'Ready to Test', complete: 'Complete' }.each do |key, db_name| %>
      <div class="kanban-column flex-shrink-0 w-64 rounded-lg p-2" 
           data-status="<%= key %>"
           data-status-id="<%= Status.find_by(name: db_name)&.id %>">
        <h3 class="text-sm font-semibold text-gray-900 mb-2">
          <%= t("views.tasks.kanban.columns.#{key}") %>
        </h3>
        <div class="kanban-tasks space-y-2 min-h-[200px]" data-status="<%= key %>">
          <!-- Tasks will be loaded here via JavaScript -->
        </div>
      </div>
    <% end %>
  </div>
</div>

<% content_for :head do %>
  <script type="module">import "kanban";</script>
<% end %>

<style>
  /* Override global h1 font-size from Bootstrap/rails_admin so title stays compact */
  .kanban-page-title {
    font-size: 1.25rem !important; /* 20px, between base and the default h1 */
  }

  /* Color transition effects */
  .kanban-tasks > div {
    transition: all 0.2s ease-in-out;
  }
  
  /* Hover effects for colored cards */
  .kanban-tasks > div:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }
  
  /* Color-specific hover effects */
  .kanban-tasks > div[class*="border-l-red"]:hover {
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.2);
  }
  
  .kanban-tasks > div[class*="border-l-orange"]:hover {
    box-shadow: 0 4px 12px rgba(249, 115, 22, 0.2);
  }
  
  .kanban-tasks > div[class*="border-l-yellow"]:hover {
    box-shadow: 0 4px 12px rgba(245, 158, 11, 0.2);
  }
  
  .kanban-tasks > div[class*="border-l-green"]:hover {
    box-shadow: 0 4px 12px rgba(34, 197, 94, 0.2);
  }
  
  .kanban-tasks > div[class*="border-l-blue"]:hover {
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
  }
  
  .kanban-tasks > div[class*="border-l-purple"]:hover {
    box-shadow: 0 4px 12px rgba(147, 51, 234, 0.2);
  }
  
  .kanban-tasks > div[class*="border-l-pink"]:hover {
    box-shadow: 0 4px 12px rgba(236, 72, 153, 0.2);
  }
  
  .kanban-tasks > div[class*="border-l-gray"]:hover {
    box-shadow: 0 4px 12px rgba(107, 114, 128, 0.2);
  }

  /* Smooth color transitions for project cards */
  .bg-white {
    transition: all 0.3s ease-in-out;
  }

  /* Enhanced color styling for project cards */
  .border-l-4 {
    border-left-width: 4px;
  }

  /* Subtle color tinting for better visual hierarchy */
  .bg-red-50 { background-color: rgba(254, 242, 242, 0.8); }
  .bg-orange-50 { background-color: rgba(255, 247, 237, 0.8); }
  .bg-yellow-50 { background-color: rgba(254, 249, 195, 0.8); }
  .bg-green-50 { background-color: rgba(240, 253, 244, 0.8); }
  .bg-blue-50 { background-color: rgba(239, 246, 255, 0.8); }
  .bg-purple-50 { background-color: rgba(250, 245, 255, 0.8); }
  .bg-pink-50 { background-color: rgba(253, 242, 248, 0.8); }
  .bg-gray-50 { background-color: rgba(249, 250, 251, 0.8); }
</style> 